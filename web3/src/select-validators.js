#!/usr/bin/env node

const yargs = require('yargs');
const fs = require('fs');

const argv = yargs
    .option('count', {
        description: 'The number of validators to select',
        type: 'string',
        demandOption: true,
        requiresArg: true,
    })
    .option('file', {
        description: 'Deposit data file generated by staking-deposit-cli',
        array: true,
        type: 'string',
        demandOption: true,
        requiresArg: true,
    })
    .help()
    .alias('count', 'c')
    .alias('file', 'f')
    .alias('help', 'h').argv;

(async function() {
    const data = argv.file
        .map(file => {
            const data = JSON.parse(fs.readFileSync(file));
            return data;
        })
        .reduce((acc, cur) => acc.concat(cur), [])
        .sort((a, b) => {
            if (a.pubkey < b.pubkey) {
                return -1;
            } else if (a.pubkey > b.pubkey) {
                return 1;
            }
            throw 'The deposit data file contains duplicated public keys';
        })
        .splice(-argv.count);

    console.log(JSON.stringify(data));
    process.exit();
})();
